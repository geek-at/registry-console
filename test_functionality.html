<!DOCTYPE html>
<html>
<head>
    <title>Registry UI - Functionality Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .pending { background-color: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>Registry UI - Functionality Test</h1>
    
    <div id="test-results"></div>
    
    <script>
        const results = document.getElementById('test-results');
        
        function addResult(test, status, message) {
            const div = document.createElement('div');
            div.className = `test-result ${status}`;
            div.innerHTML = `<strong>${test}:</strong> ${message}`;
            results.appendChild(div);
        }
        
        async function runTests() {
            // Test 1: API Endpoints
            try {
                const reposResponse = await fetch('/api/repositories');
                const reposData = await reposResponse.json();
                if (reposData.repositories && reposData.repositories.length > 0) {
                    addResult('API - Repositories', 'pass', `Found ${reposData.repositories.length} repositories`);
                } else {
                    addResult('API - Repositories', 'fail', 'No repositories found');
                }
            } catch (error) {
                addResult('API - Repositories', 'fail', `Error: ${error.message}`);
            }
            
            // Test 2: Statistics API
            try {
                const statsResponse = await fetch('/api/stats');
                const statsData = await statsResponse.json();
                if (statsData.basic && statsData.basic.totalRepositories) {
                    addResult('API - Statistics', 'pass', `Total repositories: ${statsData.basic.totalRepositories}`);
                } else {
                    addResult('API - Statistics', 'fail', 'Invalid statistics data');
                }
            } catch (error) {
                addResult('API - Statistics', 'fail', `Error: ${error.message}`);
            }
            
            // Test 3: Individual Repository Tags
            try {
                const tagResponse = await fetch('/api/repositories/frontend/tags');
                const tagData = await tagResponse.json();
                if (tagData.tags && tagData.tags.length > 0) {
                    addResult('API - Repository Tags', 'pass', `Frontend has ${tagData.tags.length} tags`);
                } else {
                    addResult('API - Repository Tags', 'fail', 'No tags found for frontend repository');
                }
            } catch (error) {
                addResult('API - Repository Tags', 'fail', `Error: ${error.message}`);
            }
            
            // Test 4: Main Page Elements
            setTimeout(() => {
                const iframe = document.createElement('iframe');
                iframe.src = '/';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                iframe.onload = function() {
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const repositoriesList = iframeDoc.getElementById('repositoriesList');
                        const homeStats = iframeDoc.getElementById('homeStats');
                        const navItems = iframeDoc.querySelectorAll('.nav-item');
                        
                        if (repositoriesList) {
                            addResult('UI - Repository List Element', 'pass', 'Repository list element exists');
                        } else {
                            addResult('UI - Repository List Element', 'fail', 'Repository list element missing');
                        }
                        
                        if (homeStats) {
                            addResult('UI - Home Stats Element', 'pass', 'Home stats element exists');
                        } else {
                            addResult('UI - Home Stats Element', 'fail', 'Home stats element missing');
                        }
                        
                        if (navItems.length >= 3) {
                            addResult('UI - Navigation Items', 'pass', `Found ${navItems.length} navigation items`);
                        } else {
                            addResult('UI - Navigation Items', 'fail', 'Not enough navigation items');
                        }
                        
                        document.body.removeChild(iframe);
                    } catch (error) {
                        addResult('UI - Elements Check', 'fail', `Error: ${error.message}`);
                    }
                };
            }, 500);
        }
        
        // Run tests when page loads
        runTests();
    </script>
</body>
</html>
